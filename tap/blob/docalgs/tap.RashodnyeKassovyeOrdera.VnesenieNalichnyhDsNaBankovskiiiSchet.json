{
  "script": {
    "title": "script",
    "sources": "//Проведение документа\r\nfunction activate(currentDocument) {\r\n\r\n    if (!notValid(currentDocument)) {\r\n        for (let tableRec of currentDocument.getRows()){\r\n            \r\n            //создание и заполнение проводок\r\n            \r\n            let RazdelLicevyhSchetov \u003d currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.RazdelLicevyhSchetov\u0027);\r\n            let KorSchet \u003d currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.KorSchet\u0027);\r\n            let KFO \u003d  tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.KFO\u0027).getCode();\r\n            let VidKPS \u003d  tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.KPS\u0027).get(\u0027tap.KPS.Vid\u0027);\r\n            let KorSchetNum \u003d KorSchet.getCode().substr(18,5);\r\n            \r\n            \r\n            //1. Основная проводка\r\n            let posting1 \u003d EntityFactory.createPosting();\r\n            KorSchet.put(0, RazdelLicevyhSchetov);\r\n            posting1.setDebit(KorSchet);\r\n            posting1.setCredit(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.SchetKt\u0027));\r\n            posting1.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n            posting1.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle())\r\n            currentDocument.addPosting(posting1);\r\n          \r\n            //2. Забалансовая проводка\r\n            let posting2 \u003d EntityFactory.createPosting();\r\n            let shetCt2 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u00270000000000000000000НД00000\u0027).get(0);\r\n            posting2.setCredit(shetCt2);\r\n            posting2.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n            posting2.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n            currentDocument.addPosting(posting2);\r\n\r\n            //3. Проводка по сч.17, л/с, БЮДЖЕТ\r\n            if ( KFO \u003d\u003d\u003d \u00271\u0027 \u0026\u0026 VidKPS !\u003d \"КРБ\" ){\r\n                let posting3 \u003d EntityFactory.createPosting();\r\n                let shetDt3;\r\n                if (KorSchetNum \u003d\u003d\u003d \u002720127\u0027){\r\n                    shetDt3 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001707000\u0027).get(0);\r\n                } else if (KorSchetNum \u003d\u003d\u003d \u002720123\u0027){\r\n                    shetDt3 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001703000\u0027).get(0);\r\n                } else {\r\n                    shetDt3 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001701000\u0027).get(0);\r\n                }\r\n                shetDt3.put(0, RazdelLicevyhSchetov);\r\n                posting3.setDebit(shetDt3);\r\n                posting3.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n                posting3.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n                currentDocument.addPosting(posting3);\r\n            }\r\n            \r\n              //4. Проводка по сч.18, л/с, БЮДЖЕТ\r\n            if ( KFO \u003d\u003d\u003d \u00271\u0027 \u0026\u0026 VidKPS \u003d\u003d\u003d \"КРБ\" ){\r\n                let posting4 \u003d EntityFactory.createPosting();\r\n                let shetDt4;\r\n                if (KorSchetNum \u003d\u003d\u003d \u002720127\u0027){\r\n                    shetDt4 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001807000\u0027).get(0);\r\n                } else if (KorSchetNum \u003d\u003d\u003d \u002720123\u0027){\r\n                    shetDt4 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001803000\u0027).get(0);\r\n                } else {\r\n                    shetDt4 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001801000\u0027).get(0);\r\n                }\r\n                shetDt4.put(0, RazdelLicevyhSchetov);\r\n                posting4.setDebit(shetDt4);\r\n                posting4.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n                posting4.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n                currentDocument.addPosting(posting4);\r\n            }\r\n            \r\n              //5. Проводка по сч.17, л/с, ВНЕБЮДЖЕТ\r\n            if ( KFO !\u003d\u003d \u00271\u0027){\r\n                let posting5 \u003d EntityFactory.createPosting();\r\n                let shetDt5;\r\n                if (KorSchetNum \u003d\u003d\u003d \u002720127\u0027){\r\n                    shetDt5 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001707000\u0027).get(0);\r\n                } else if (KorSchetNum \u003d\u003d\u003d \u002720123\u0027){\r\n                    shetDt5 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001703000\u0027).get(0);\r\n                } else {\r\n                    shetDt5 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001701000\u0027).get(0);\r\n                }\r\n                shetDt5.put(0, RazdelLicevyhSchetov);\r\n                posting5.setDebit(shetDt5);\r\n                posting5.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n                posting5.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n                currentDocument.addPosting(posting5);\r\n            }\r\n\r\n            //6. Проводка по сч.17, касса, БЮДЖЕТ\r\n            if ( KFO \u003d\u003d\u003d \u00271\u0027 \u0026\u0026 VidKPS !\u003d \"КРБ\" ){\r\n                let posting6 \u003d EntityFactory.createPosting();\r\n                let shetKt6 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001734000\u0027).get(0);\r\n                posting6.setCredit(shetKt6);\r\n                posting6.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n                posting6.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n                currentDocument.addPosting(posting6);\r\n            }\r\n            \r\n            //7. Проводка по сч.18, касса, БЮДЖЕТ\r\n            if ( KFO \u003d\u003d\u003d \u00271\u0027 \u0026\u0026 VidKPS \u003d\u003d\u003d \"КРБ\" ){\r\n                let posting7 \u003d EntityFactory.createPosting();\r\n                let shetKt7 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001834000\u0027).get(0);\r\n                posting7.setCredit(shetKt7);\r\n                posting7.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n                posting7.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n                currentDocument.addPosting(posting7);\r\n            }\r\n            \r\n             //8. Проводка по сч.18, касса, ВНЕБЮДЖЕТ\r\n            if ( KFO !\u003d\u003d \u00271\u0027){\r\n                let posting8 \u003d EntityFactory.createPosting();\r\n                let shetKt8 \u003d EntityFactory.getPlan().getAccounts().findByCode(\u002700000000000000000001734000\u0027).get(0);\r\n                posting8.setCredit(shetKt8);\r\n                posting8.setValue(tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027));\r\n                posting8.setComment(currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Osnovanie\u0027)?.getTitle());\r\n                currentDocument.addPosting(posting8);\r\n            }\r\n\r\n\r\n        };\r\n                \r\n        //устанавливаем текущую дату проводки\r\n        currentDocument.setExecuted();\r\n\r\n        //сохранение документа с проводками\r\n        currentDocument.save();\r\n\r\n        return; \r\n\r\n    } else return notValid(currentDocument);\r\n        \r\n}\r\n\r\n//Снятие документа с проведения\r\nfunction deactivate(currentDocument) {\r\n    currentDocument.removeAllPostings();\r\n    currentDocument.setExecutedDate(null);\r\n    currentDocument.save();\r\n    return;\r\n}\r\n\r\n//Проверка документа на полное заполнение\r\nfunction notValid(currentDocument) { \r\n    let resultValidate \u003d currentDocument.validate();\r\n    let korSchetNotCorrect;\r\n    let organization \u003d EntityFactory.getOrganization();\r\n    \r\n     //Документ должен быть оплачен\r\n    if (!currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Oplacheno\u0027))\r\n        resultValidate.addValueError(\u0027tap.RashodnyeKassovyeOrdera.hr.Oplacheno\u0027, \u0027Документ должен быть оплачен\u0027);\r\n    \r\n       //раздел лицевых счетов должен быть заполнен\r\n    if (!currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.RazdelLicevyhSchetov\u0027))\r\n        resultValidate.addValueError(\u0027tap.RashodnyeKassovyeOrdera.hr.RazdelLicevyhSchetov\u0027, \u0027Не заполнено обязательное поле\u0027);\r\n\r\n    // Счет кредита должен быть 20134\r\n    if ( currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.SchetKt\u0027) \u0026\u0026\r\n        currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.SchetKt\u0027).getCode().substr(18,5) !\u003d\u003d \u002720134\u0027) \r\n            resultValidate.addValueError(\u0027tap.RashodnyeKassovyeOrdera.hr.SchetKt\u0027, \u0027Счет должен принимать значение 201.34\u0027);\r\n    \r\n    //Допустимые значения счетов данного алгоритма\r\n    if (currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.KorSchet\u0027)){\r\n        let korSchet \u003d currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.KorSchet\u0027).getCode().substr(18,5);\r\n        //бюджетное\r\n        if ( korSchet !\u003d\u003d \u002720123\u0027 \u0026\u0026 korSchet !\u003d\u003d \u002720127\u0027  \u0026\u0026 organization.isBudgetnoe()){\r\n                korSchetNotCorrect \u003d true\r\n                resultValidate.addValueError(\u0027tap.RashodnyeKassovyeOrdera.hr.KorSchet\u0027, \u0027Может принимать значения 201.23 и 201.27\u0027);\r\n        //казенное и автономное\r\n        } else if ( korSchet !\u003d\u003d \u002720121\u0027 \u0026\u0026 korSchet !\u003d\u003d \u002720123\u0027 \u0026\u0026 korSchet !\u003d\u003d \u002720127\u0027 ){\r\n                korSchetNotCorrect \u003d true\r\n                resultValidate.addValueError(\u0027tap.RashodnyeKassovyeOrdera.hr.KorSchet\u0027, \u0027Может принимать значения 201.21, 201.23 или 201.27\u0027);\r\n            }\r\n    } \r\n    \r\n    //Заполнена табличная часть\r\n    if (!currentDocument.getRows().size())\r\n        resultValidate.addValueError(\u0027Не заполнена табличная часть документа.\u0027);\r\n    else {\r\n\r\n        let tableSum \u003d 0;\r\n        let docSum \u003d +currentDocument.get(\u0027tap.RashodnyeKassovyeOrdera.hr.Summa\u0027)\r\n\r\n        for (let tableRec of currentDocument.getRows()){\r\n            tableSum +\u003d +tableRec.get(\u0027tap.RashodnyeKassovyeOrdera.tr.Summa\u0027);     \r\n        }\r\n\r\n        // сумма в шапке ровняется сумме всех строк\r\n        if (tableSum.toFixed(2) !\u003d\u003d docSum.toFixed(2))\r\n            resultValidate.addValueError(`Сумма(всего) (${docSum.toFixed(2)}) не совпадает с суммой строк в табличной части (${tableSum.toFixed(2)})`);\r\n\r\n    } \r\n    \r\n    if (resultValidate.hasErrors() || resultValidate.hasValueErrors() ) \r\n        return  resultValidate;\r\n}"
  },
  "template": {
    "universal": false,
    "date": {
      "celltype": "OPERATION_DATE",
      "formulaEnabled": "true",
      "sourceMnemo": "",
      "prompt": {},
      "index": 0
    },
    "number": {
      "celltype": "OPERATION_NUMBER",
      "formulaEnabled": "true",
      "sourceMnemo": "",
      "prompt": {},
      "index": 0
    },
    "summ": {
      "celltype": "OPERATION_SUM",
      "formulaEnabled": "true",
      "sourceMnemo": "",
      "prompt": {},
      "index": 0
    },
    "operation_description": {
      "celltype": "OPERATION_DESCRIPTION",
      "formulaEnabled": "true",
      "sourceMnemo": "",
      "prompt": {},
      "index": 0
    },
    "operations": []
  },
  "runastemplate": false,
  "grants": {},
  "meta": {
    "mnemo": "tap.RashodnyeKassovyeOrdera.VnesenieNalichnyhDsNaBankovskiiiSchet",
    "title": {
      "ru_RU": "Внесение наличных на банковский счет",
      "en_EN": "Vnesenie nalichnyh na bankovskiii schet"
    },
    "description": {}
  }
}